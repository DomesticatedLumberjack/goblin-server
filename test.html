<html>
<div>
  <h1>Go websockets goblin test</h1>
  <button onclick="test()">Test Req</button>
  <button onclick="create()">Create Game</button>
  <div>
    <input id="input" type="text" placeholder="Enter game code" />
    <button onclick="join()">Join Game</button>
  </div>
  <pre id="output"></pre>
</div>
<style>
  html {
    text-align: center;
    font-size: 16px;
  }

  div {
    padding: 1rem;
  }

  #input {
    font-size: 16px;
  }

  p {
    font-size: 16px;
  }
</style>
<script>
  const input = document.getElementById("input");
  const output = document.getElementById("output");
  let socket;

  const connect = () => {
    socket = new WebSocket("ws://localhost:8080/ws");

    socket.onopen = function () {
      output.innerHTML += "Status: Connected\n";
    };

    socket.onmessage = function (e) {
      console.log("Received: " + e.data);
      output.innerHTML += "\nServer: " + e.data + "\n";
    };

    socket.onclose = function (e) {
      console.log('Socket is closed. Reconnect will be attempted in 1 second.', e.reason);
      setTimeout(function () {
        connect();
      }, 1000);
    };

    socket.onerror = function (err) {
      console.error('Socket encountered error: ', err.message, 'Closing socket');
      socket.close();
    };
  }

  connect();

  function send(data) {
    const message = JSON.stringify(data);
    console.log("Sending: " + message);
    socket.send(message);
  }

  function join() {
    const code = input.value;
    send({
      command: "join",
      data: {
        code: code
      }
    });
  }

  function create() {
    send({
      command: "create"
    });
  }

  function test() {
    send({
      command: "test",
      data: {
        message: "test"
      }
    });
  }
</script>

</html>